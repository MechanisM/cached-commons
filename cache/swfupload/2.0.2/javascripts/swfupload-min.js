var SWFUpload=function(a){this.initSWFUpload(a)};SWFUpload.prototype.initSWFUpload=function(a){try{document.execCommand("BackgroundImageCache",false,true)}catch(c){}try{this.customSettings={};this.settings={};this.eventQueue=[];this.movieName="SWFUpload_"+SWFUpload.movieCount++;this.movieElement=null;SWFUpload.instances[this.movieName]=this;this.initSettings(a);this.loadFlash();this.displayDebugInfo()}catch(b){this.debug(b)}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};SWFUpload.prototype.initSettings=function(a){this.addSetting("upload_url",a.upload_url,"");this.addSetting("file_post_name",a.file_post_name,"Filedata");this.addSetting("post_params",a.post_params,{});this.addSetting("file_types",a.file_types,"*.*");this.addSetting("file_types_description",a.file_types_description,"All Files");this.addSetting("file_size_limit",a.file_size_limit,"1024");this.addSetting("file_upload_limit",a.file_upload_limit,"0");this.addSetting("file_queue_limit",a.file_queue_limit,"0");this.addSetting("flash_url",a.flash_url,"swfupload.swf");this.addSetting("flash_width",a.flash_width,"1px");this.addSetting("flash_height",a.flash_height,"1px");this.addSetting("flash_color",a.flash_color,"#FFFFFF");this.addSetting("debug_enabled",a.debug,false);this.flashReady_handler=SWFUpload.flashReady;this.swfUploadLoaded_handler=this.retrieveSetting(a.swfupload_loaded_handler,SWFUpload.swfUploadLoaded);this.fileDialogStart_handler=this.retrieveSetting(a.file_dialog_start_handler,SWFUpload.fileDialogStart);this.fileQueued_handler=this.retrieveSetting(a.file_queued_handler,SWFUpload.fileQueued);this.fileQueueError_handler=this.retrieveSetting(a.file_queue_error_handler,SWFUpload.fileQueueError);this.fileDialogComplete_handler=this.retrieveSetting(a.file_dialog_complete_handler,SWFUpload.fileDialogComplete);this.uploadStart_handler=this.retrieveSetting(a.upload_start_handler,SWFUpload.uploadStart);this.uploadProgress_handler=this.retrieveSetting(a.upload_progress_handler,SWFUpload.uploadProgress);this.uploadError_handler=this.retrieveSetting(a.upload_error_handler,SWFUpload.uploadError);this.uploadSuccess_handler=this.retrieveSetting(a.upload_success_handler,SWFUpload.uploadSuccess);this.uploadComplete_handler=this.retrieveSetting(a.upload_complete_handler,SWFUpload.uploadComplete);this.debug_handler=this.retrieveSetting(a.debug_handler,SWFUpload.debug);this.customSettings=this.retrieveSetting(a.custom_settings,{})};SWFUpload.prototype.loadFlash=function(){var c,d,a;if(document.getElementById(this.movieName)!==null){return false}try{d=document.getElementsByTagName("body")[0];if(typeof(d)==="undefined"||d===null){this.debug("Could not find the BODY element. SWFUpload failed to load.");return false}}catch(b){return false}a=document.createElement("div");a.style.width=this.getSetting("flash_width");a.style.height=this.getSetting("flash_height");d.appendChild(a);a.innerHTML=this.getFlashHTML()};SWFUpload.prototype.getFlashHTML=function(){var a="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){a='<embed type="application/x-shockwave-flash" src="'+this.getSetting("flash_url")+'" width="'+this.getSetting("flash_width")+'" height="'+this.getSetting("flash_height")+'"';a+=' id="'+this.movieName+'" name="'+this.movieName+'" ';a+='bgcolor="'+this.getSetting("flash_color")+'" quality="high" menu="false" flashvars="';a+=this.getFlashVars();a+='" />'}else{a='<object id="'+this.movieName+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.getSetting("flash_width")+'" height="'+this.getSetting("flash_height")+'">';a+='<param name="movie" value="'+this.getSetting("flash_url")+'">';a+='<param name="bgcolor" value="'+this.getSetting("flash_color")+'" />';a+='<param name="quality" value="high" />';a+='<param name="menu" value="false" />';a+='<param name="flashvars" value="'+this.getFlashVars()+'" />';a+="</object>"}return a};SWFUpload.prototype.getFlashVars=function(){var b=this.buildParamString();var a="";a+="movieName="+encodeURIComponent(this.movieName);a+="&uploadURL="+encodeURIComponent(this.getSetting("upload_url"));a+="&params="+encodeURIComponent(b);a+="&filePostName="+encodeURIComponent(this.getSetting("file_post_name"));a+="&fileTypes="+encodeURIComponent(this.getSetting("file_types"));a+="&fileTypesDescription="+encodeURIComponent(this.getSetting("file_types_description"));a+="&fileSizeLimit="+encodeURIComponent(this.getSetting("file_size_limit"));a+="&fileUploadLimit="+encodeURIComponent(this.getSetting("file_upload_limit"));a+="&fileQueueLimit="+encodeURIComponent(this.getSetting("file_queue_limit"));a+="&debugEnabled="+encodeURIComponent(this.getSetting("debug_enabled"));return a};SWFUpload.prototype.getMovieElement=function(){if(typeof(this.movieElement)==="undefined"||this.movieElement===null){this.movieElement=document.getElementById(this.movieName)}return this.movieElement};SWFUpload.prototype.buildParamString=function(){var b=this.getSetting("post_params");var e=[];var c,d,a;if(typeof(b)==="object"){for(a in b){if(b.hasOwnProperty(a)){if(typeof(b[a])==="string"){e.push(encodeURIComponent(a)+"="+encodeURIComponent(b[a]))}}}}return e.join("&")};SWFUpload.prototype.addSetting=function(b,c,a){if(typeof(c)==="undefined"||c===null){this.settings[b]=a}else{this.settings[b]=c}return this.settings[b]};SWFUpload.prototype.getSetting=function(a){if(typeof(this.settings[a])==="undefined"){return""}else{return this.settings[a]}};SWFUpload.prototype.retrieveSetting=function(b,a){if(typeof(b)==="undefined"||b===null){return a}else{return b}};SWFUpload.prototype.displayDebugInfo=function(){var b,a="";a+="----- SWFUPLOAD SETTINGS     ----\nID: "+this.moveName+"\n";a+=this.outputObject(this.settings);a+="----- SWFUPLOAD SETTINGS END ----\n";a+="\n";this.debug(a)};SWFUpload.prototype.outputObject=function(b,d){var a="",c;if(typeof(d)!=="string"){d=""}if(typeof(b)!=="object"){return""}for(c in b){if(b.hasOwnProperty(c)){if(typeof(b[c])==="object"){a+=(d+c+": { \n"+this.outputObject(b[c],"\t"+d)+d+"}\n")}else{a+=(d+c+": "+b[c]+"\n")}}}return a};SWFUpload.prototype.selectFile=function(){var b=this.getMovieElement();if(b!==null&&typeof(b.SelectFile)==="function"){try{b.SelectFile()}catch(a){this.debug("Could not call SelectFile: "+a)}}else{this.debug("Could not find Flash element")}};SWFUpload.prototype.selectFiles=function(){var b=this.getMovieElement();if(b!==null&&typeof(b.SelectFiles)==="function"){try{b.SelectFiles()}catch(a){this.debug("Could not call SelectFiles: "+a)}}else{this.debug("Could not find Flash element")}};SWFUpload.prototype.startUpload=function(c){var a=this;var b=this.getMovieElement();if(b!==null&&typeof(b.StartUpload)==="function"){setTimeout(function(){try{b.StartUpload(c)}catch(d){a.debug("Could not call StartUpload: "+d)}},0)}else{this.debug("Could not find Flash element")}};SWFUpload.prototype.cancelUpload=function(c){var b=this.getMovieElement();if(b!==null&&typeof(b.CancelUpload)==="function"){try{b.CancelUpload(c)}catch(a){this.debug("Could not call CancelUpload: "+a)}}else{this.debug("Could not find Flash element")}};SWFUpload.prototype.stopUpload=function(){var b=this.getMovieElement();if(b!==null&&typeof(b.StopUpload)==="function"){try{b.StopUpload()}catch(a){this.debug("Could not call StopUpload: "+a)}}else{this.debug("Could not find Flash element")}};SWFUpload.prototype.getStats=function(){var b=this.getMovieElement();if(b!==null&&typeof(b.GetStats)==="function"){try{return b.GetStats()}catch(a){this.debug("Could not call GetStats")}}else{this.debug("Could not find Flash element")}};SWFUpload.prototype.setStats=function(c){var b=this.getMovieElement();if(b!==null&&typeof(b.SetStats)==="function"){try{b.SetStats(c)}catch(a){this.debug("Could not call SetStats")}}else{this.debug("Could not find Flash element")}};SWFUpload.prototype.setCredentials=function(b,a){var d=this.getMovieElement();if(d!==null&&typeof(d.SetCredentials)==="function"){try{return d.SetCredentials(b,a)}catch(c){this.debug("Could not call SetCredentials")}}else{this.debug("Could not find Flash element")}};SWFUpload.prototype.getFile=function(c){var b=this.getMovieElement();if(typeof(c)==="number"){if(b!==null&&typeof(b.GetFileByIndex)==="function"){try{return b.GetFileByIndex(c)}catch(a){this.debug("Could not call GetFileByIndex")}}else{this.debug("Could not find Flash element")}}else{if(b!==null&&typeof(b.GetFile)==="function"){try{return b.GetFile(c)}catch(a){this.debug("Could not call GetFile")}}else{this.debug("Could not find Flash element")}}};SWFUpload.prototype.addFileParam=function(d,a,e){var c=this.getMovieElement();if(c!==null&&typeof(c.AddFileParam)==="function"){try{return c.AddFileParam(d,a,e)}catch(b){this.debug("Could not call AddFileParam")}}else{this.debug("Could not find Flash element")}};SWFUpload.prototype.removeFileParam=function(d,a){var c=this.getMovieElement();if(c!==null&&typeof(c.RemoveFileParam)==="function"){try{return c.RemoveFileParam(d,a)}catch(b){this.debug("Could not call AddFileParam")}}else{this.debug("Could not find Flash element")}};SWFUpload.prototype.setUploadURL=function(a){var c=this.getMovieElement();if(c!==null&&typeof(c.SetUploadURL)==="function"){try{this.addSetting("upload_url",a);c.SetUploadURL(this.getSetting("upload_url"))}catch(b){this.debug("Could not call SetUploadURL")}}else{this.debug("Could not find Flash element in setUploadURL")}};SWFUpload.prototype.setPostParams=function(c){var b=this.getMovieElement();if(b!==null&&typeof(b.SetPostParams)==="function"){try{this.addSetting("post_params",c);b.SetPostParams(this.getSetting("post_params"))}catch(a){this.debug("Could not call SetPostParams")}}else{this.debug("Could not find Flash element in SetPostParams")}};SWFUpload.prototype.setFileTypes=function(b,d){var c=this.getMovieElement();if(c!==null&&typeof(c.SetFileTypes)==="function"){try{this.addSetting("file_types",b);this.addSetting("file_types_description",d);c.SetFileTypes(this.getSetting("file_types"),this.getSetting("file_types_description"))}catch(a){this.debug("Could not call SetFileTypes")}}else{this.debug("Could not find Flash element in SetFileTypes")}};SWFUpload.prototype.setFileSizeLimit=function(a){var c=this.getMovieElement();if(c!==null&&typeof(c.SetFileSizeLimit)==="function"){try{this.addSetting("file_size_limit",a);c.SetFileSizeLimit(this.getSetting("file_size_limit"))}catch(b){this.debug("Could not call SetFileSizeLimit")}}else{this.debug("Could not find Flash element in SetFileSizeLimit")}};SWFUpload.prototype.setFileUploadLimit=function(a){var c=this.getMovieElement();if(c!==null&&typeof(c.SetFileUploadLimit)==="function"){try{this.addSetting("file_upload_limit",a);c.SetFileUploadLimit(this.getSetting("file_upload_limit"))}catch(b){this.debug("Could not call SetFileUploadLimit")}}else{this.debug("Could not find Flash element in SetFileUploadLimit")}};SWFUpload.prototype.setFileQueueLimit=function(c){var b=this.getMovieElement();if(b!==null&&typeof(b.SetFileQueueLimit)==="function"){try{this.addSetting("file_queue_limit",c);b.SetFileQueueLimit(this.getSetting("file_queue_limit"))}catch(a){this.debug("Could not call SetFileQueueLimit")}}else{this.debug("Could not find Flash element in SetFileQueueLimit")}};SWFUpload.prototype.setFilePostName=function(b){var c=this.getMovieElement();if(c!==null&&typeof(c.SetFilePostName)==="function"){try{this.addSetting("file_post_name",b);c.SetFilePostName(this.getSetting("file_post_name"))}catch(a){this.debug("Could not call SetFilePostName")}}else{this.debug("Could not find Flash element in SetFilePostName")}};SWFUpload.prototype.setDebugEnabled=function(c){var b=this.getMovieElement();if(b!==null&&typeof(b.SetDebugEnabled)==="function"){try{this.addSetting("debug_enabled",c);b.SetDebugEnabled(this.getSetting("debug_enabled"))}catch(a){this.debug("Could not call SetDebugEnabled")}}else{this.debug("Could not find Flash element in SetDebugEnabled")}};SWFUpload.prototype.flashReady=function(){var b=this.getMovieElement();if(b===null||typeof(b.StartUpload)!=="function"){this.debug("ExternalInterface methods failed to initialize.");return}var a=this;if(typeof(a.flashReady_handler)==="function"){this.eventQueue[this.eventQueue.length]=function(){a.flashReady_handler()};setTimeout(function(){a.executeNextEvent()},0)}else{this.debug("flashReady_handler event not defined")}};SWFUpload.prototype.executeNextEvent=function(){var a=this.eventQueue.shift();if(typeof(a)==="function"){a()}};SWFUpload.prototype.fileDialogStart=function(){var a=this;if(typeof(a.fileDialogStart_handler)==="function"){this.eventQueue[this.eventQueue.length]=function(){a.fileDialogStart_handler()};setTimeout(function(){a.executeNextEvent()},0)}else{this.debug("fileDialogStart event not defined")}};SWFUpload.prototype.fileQueued=function(b){var a=this;if(typeof(a.fileQueued_handler)==="function"){this.eventQueue[this.eventQueue.length]=function(){a.fileQueued_handler(b)};setTimeout(function(){a.executeNextEvent()},0)}else{this.debug("fileQueued event not defined")}};SWFUpload.prototype.fileQueueError=function(c,b,d){var a=this;if(typeof(a.fileQueueError_handler)==="function"){this.eventQueue[this.eventQueue.length]=function(){a.fileQueueError_handler(c,b,d)};setTimeout(function(){a.executeNextEvent()},0)}else{this.debug("fileQueueError event not defined")}};SWFUpload.prototype.fileDialogComplete=function(b){var a=this;if(typeof(a.fileDialogComplete_handler)==="function"){this.eventQueue[this.eventQueue.length]=function(){a.fileDialogComplete_handler(b)};setTimeout(function(){a.executeNextEvent()},0)}else{this.debug("fileDialogComplete event not defined")}};SWFUpload.prototype.uploadStart=function(b){var a=this;if(typeof(a.fileDialogComplete_handler)==="function"){this.eventQueue[this.eventQueue.length]=function(){a.returnUploadStart(a.uploadStart_handler(b))};setTimeout(function(){a.executeNextEvent()},0)}else{this.debug("uploadStart event not defined")}};SWFUpload.prototype.returnUploadStart=function(a){var c=this.getMovieElement();if(c!==null&&typeof(c.ReturnUploadStart)==="function"){try{c.ReturnUploadStart(a)}catch(b){this.debug("Could not call ReturnUploadStart")}}else{this.debug("Could not find Flash element in returnUploadStart")}};SWFUpload.prototype.uploadProgress=function(b,d,c){var a=this;if(typeof(a.uploadProgress_handler)==="function"){this.eventQueue[this.eventQueue.length]=function(){a.uploadProgress_handler(b,d,c)};setTimeout(function(){a.executeNextEvent()},0)}else{this.debug("uploadProgress event not defined")}};SWFUpload.prototype.uploadError=function(c,b,d){var a=this;if(typeof(this.uploadError_handler)==="function"){this.eventQueue[this.eventQueue.length]=function(){a.uploadError_handler(c,b,d)};setTimeout(function(){a.executeNextEvent()},0)}else{this.debug("uploadError event not defined")}};SWFUpload.prototype.uploadSuccess=function(c,b){var a=this;if(typeof(a.uploadSuccess_handler)==="function"){this.eventQueue[this.eventQueue.length]=function(){a.uploadSuccess_handler(c,b)};setTimeout(function(){a.executeNextEvent()},0)}else{this.debug("uploadSuccess event not defined")}};SWFUpload.prototype.uploadComplete=function(b){var a=this;if(typeof(a.uploadComplete_handler)==="function"){this.eventQueue[this.eventQueue.length]=function(){a.uploadComplete_handler(b)};setTimeout(function(){a.executeNextEvent()},0)}else{this.debug("uploadComplete event not defined")}};SWFUpload.prototype.debug=function(b){var a=this;if(typeof(a.debug_handler)==="function"){this.eventQueue[this.eventQueue.length]=function(){a.debug_handler(b)};setTimeout(function(){a.executeNextEvent()},0)}else{this.eventQueue[this.eventQueue.length]=function(){a.debugMessage(b)};setTimeout(function(){a.executeNextEvent()},0)}};SWFUpload.flashReady=function(){try{this.debug("Flash called back and is ready.");if(typeof(this.swfUploadLoaded_handler)==="function"){this.swfUploadLoaded_handler()}}catch(a){this.debug(a)}};SWFUpload.swfUploadLoaded=function(){};SWFUpload.fileDialogStart=function(){};SWFUpload.fileQueued=function(a){};SWFUpload.fileQueueError=function(c,a,d){try{switch(a){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:this.debug("Error Code: File too big, File name: "+c.name+", File size: "+c.size+", Message: "+d);break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:this.debug("Error Code: Zero Byte File, File name: "+c.name+", File size: "+c.size+", Message: "+d);break;case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:this.debug("Error Code: Upload limit reached, File name: "+c.name+", File size: "+c.size+", Message: "+d);break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:this.debug("Error Code: File extension is not allowed, Message: "+d);break;default:this.debug("Error Code: Unhandled error occured. Errorcode: "+a)}}catch(b){this.debug(b)}};SWFUpload.fileDialogComplete=function(a){};SWFUpload.uploadStart=function(a){return true};SWFUpload.uploadProgress=function(a,c,b){this.debug("File Progress: "+a.id+", Bytes: "+c+". Total: "+b)};SWFUpload.uploadSuccess=function(b,a){};SWFUpload.uploadComplete=function(a){};SWFUpload.debug=function(a){if(this.getSetting("debug_enabled")){this.debugMessage(a)}};SWFUpload.uploadError=function(c,a,d){try{switch(errcode){case SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND:this.debug("Error Code: File ID specified for upload was not found, Message: "+msg);break;case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:this.debug("Error Code: HTTP Error, File name: "+c.name+", Message: "+msg);break;case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL:this.debug("Error Code: No backend file, File name: "+c.name+", Message: "+msg);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:this.debug("Error Code: IO Error, File name: "+c.name+", Message: "+msg);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:this.debug("Error Code: Security Error, File name: "+c.name+", Message: "+msg);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:this.debug("Error Code: Upload limit reached, File name: "+c.name+", File size: "+c.size+", Message: "+msg);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:this.debug("Error Code: Upload Initialization exception, File name: "+c.name+", File size: "+c.size+", Message: "+msg);break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:this.debug("Error Code: uploadStart callback returned false, File name: "+c.name+", File size: "+c.size+", Message: "+msg);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:this.debug("Error Code: The file upload was cancelled, File name: "+c.name+", File size: "+c.size+", Message: "+msg);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:this.debug("Error Code: The file upload was stopped, File name: "+c.name+", File size: "+c.size+", Message: "+msg);break;default:this.debug("Error Code: Unhandled error occured. Errorcode: "+errcode)}}catch(b){this.debug(b)}};SWFUpload.prototype.debugMessage=function(c){var d,b;if(typeof(c)==="object"&&typeof(c.name)==="string"&&typeof(c.message)==="string"){d="";b=[];for(var a in c){b.push(a+": "+c[a])}d=b.join("\n");b=d.split("\n");d="EXCEPTION: "+b.join("\nEXCEPTION: ");SWFUpload.Console.writeLine(d)}else{SWFUpload.Console.writeLine(c)}};SWFUpload.Console={};SWFUpload.Console.writeLine=function(d){var b,a;try{b=document.getElementById("SWFUpload_Console");if(!b){a=document.createElement("form");document.getElementsByTagName("body")[0].appendChild(a);b=document.createElement("textarea");b.id="SWFUpload_Console";b.style.fontFamily="monospace";b.setAttribute("wrap","off");b.wrap="off";b.style.overflow="auto";b.style.width="700px";b.style.height="350px";b.style.margin="5px";a.appendChild(b)}b.value+=d+"\n";b.scrollTop=b.scrollHeight-b.clientHeight}catch(c){alert("Exception: "+c.name+" Message: "+c.message)}};
