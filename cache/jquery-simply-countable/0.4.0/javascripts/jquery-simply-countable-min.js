(function(a){a.fn.simplyCountable=function(d){d=a.extend({counter:"#counter",countType:"characters",wordSeparator:" ",maxCount:140,strictMax:false,countDirection:"down",safeClass:"safe",overClass:"over",thousandSeparator:",",onOverCount:function(){},onSafeCount:function(){},onMaxCount:function(){}},d);var e=this;var c=a(d.counter);if(!c.length){return false}regex=new RegExp("["+d.wordSeparator+"]+");var b=function(){var j;var i;var g=function(l){return l-(l*2)+d.maxCount};var k=function(){return(d.countDirection==="up")?i:j};var f=function(m){if(d.thousandSeparator){m=m.toString();for(var l=m.length-3;l>0;l-=3){m=m.substr(0,l)+d.thousandSeparator+m.substr(l)}}return m};if(d.countType==="words"){j=d.maxCount-a.trim(e.val()).split(regex).length;if(e.val()===""){j+=1}}else{j=d.maxCount-e.val().length}i=g(j);if(d.strictMax&&j<=0){var h=e.val();if(j<0||h.match(new RegExp("["+d.wordSeparator+"]$"))){d.onMaxCount(k(),e,c)}if(d.countType==="words"){e.val(h.split(regex).slice(0,d.maxCount).join(d.wordSeparator))}else{e.val(h.substring(0,d.maxCount))}j=0,i=d.maxCount}c.text(f(k()));if(!c.hasClass(d.safeClass)&&!c.hasClass(d.overClass)){if(j<0){c.addClass(d.overClass)}else{c.addClass(d.safeClass)}}else{if(j<0&&c.hasClass(d.safeClass)){c.removeClass(d.safeClass).addClass(d.overClass);d.onOverCount(k(),e,c)}else{if(j>=0&&c.hasClass(d.overClass)){c.removeClass(d.overClass).addClass(d.safeClass);d.onSafeCount(k(),e,c)}}}};b();e.keyup(b)}})(jQuery);
