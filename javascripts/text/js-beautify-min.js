function js_beautify(c,y){var b,B,o,O,k,v,z,q,d,Y;var F,U,f,m,s,X;var N,S,D;var P,Z,h;y=y?y:{};var E=y.braces_on_own_line?y.braces_on_own_line:false;var I=y.indent_size?y.indent_size:4;var g=y.indent_char?y.indent_char:" ";var R=typeof y.preserve_newlines==="undefined"?true:y.preserve_newlines;var V=y.indent_level?y.indent_level:0;var r=y.space_after_anon_function==="undefined"?false:y.space_after_anon_function;var j=typeof y.keep_array_indentation==="undefined"?true:y.keep_array_indentation;Z=false;var u=c.length;function p(){while(B.length&&(B[B.length-1]===" "||B[B.length-1]===Y)){B.pop()}}function A(aa){q.eat_next_space=false;if(j&&L(q.mode)){return}aa=typeof aa==="undefined"?true:aa;q.if_line=false;p();if(!B.length){return}if(B[B.length-1]!=="\n"||!aa){Z=true;B.push("\n")}for(var t=0;t<q.indentation_level;t+=1){B.push(Y)}}function w(){if(q.eat_next_space){q.eat_next_space=false;return}var i=" ";if(B.length){i=B[B.length-1]}if(i!==" "&&i!=="\n"&&i!==Y){B.push(" ")}}function H(){Z=false;q.eat_next_space=false;B.push(o)}function n(){q.indentation_level+=1}function M(){if(B.length&&B[B.length-1]===Y){B.pop()}}function l(i){if(q){d.push(q)}q={mode:i,var_line:false,var_line_tainted:false,var_line_reindented:false,in_html_comment:false,if_line:false,in_case:false,eat_next_space:false,indentation_baseline:-1,indentation_level:(q?q.indentation_level+(q.var_line_reindented?1:0):V)}}function C(i){return i==="[EXPRESSION]"||i==="[INDENTED-EXPRESSION]"||i==="(EXPRESSION)"}function L(i){return i==="[EXPRESSION]"||i==="[INDENTED-EXPRESSION]"}function e(){D=q.mode==="DO_BLOCK";if(d.length>0){q=d.pop()}}function J(ab,t){for(var aa=0;aa<t.length;aa+=1){if(t[aa]===ab){return true}}return false}function x(){var ab=0,aa=0;for(var t=B.length-1;t>=0;t--){switch(B[t]){case":":if(ab===0){aa++}break;case"?":if(ab===0){if(aa===0){return true}else{aa--}}break;case"{":if(ab===0){return false}ab--;break;case"(":case"[":ab--;break;case")":case"]":case"}":ab++;break}}}function T(){h=0;if(m>=u){return["","TK_EOF"]}P=false;var ai=b.charAt(m);m+=1;var ak=j&&L(q.mode);if(ak){var ac=0;while(J(ai,F)){if(ai==="\n"){p();B.push("\n");Z=true;ac=0}else{if(ai==="\t"){ac+=4}else{ac+=1}}if(m>=u){return["","TK_EOF"]}ai=b.charAt(m);m+=1}if(q.indentation_baseline===-1){q.indentation_baseline=ac}if(Z){for(var ae=0;ae<q.indentation_level+1;ae+=1){B.push(Y)}if(q.indentation_baseline!==-1){for(var ae=0;ae<ac-q.indentation_baseline;ae++){B.push(" ")}}}}else{while(J(ai,F)){if(ai==="\n"){h+=1}if(m>=u){return["","TK_EOF"]}ai=b.charAt(m);m+=1}if(R){if(h>1){for(var ae=0;ae<h;ae+=1){A(ae===0);Z=true}}}P=h>0}if(J(ai,U)){if(m<u){while(J(b.charAt(m),U)){ai+=b.charAt(m);m+=1;if(m===u){break}}}if(m!==u&&ai.match(/^[0-9]+[Ee]$/)&&(b.charAt(m)==="-"||b.charAt(m)==="+")){var ab=b.charAt(m);m+=1;var al=T(m);ai+=ab+al[0];return[ai,"TK_WORD"]}if(ai==="in"){return[ai,"TK_OPERATOR"]}if(P&&O!=="TK_OPERATOR"&&!q.if_line&&(R||k!=="var")){A()}return[ai,"TK_WORD"]}if(ai==="("||ai==="["){return[ai,"TK_START_EXPR"]}if(ai===")"||ai==="]"){return[ai,"TK_END_EXPR"]}if(ai==="{"){return[ai,"TK_START_BLOCK"]}if(ai==="}"){return[ai,"TK_END_BLOCK"]}if(ai===";"){return[ai,"TK_SEMICOLON"]}if(ai==="/"){var af="";var aj=true;if(b.charAt(m)==="*"){m+=1;if(m<u){while(!(b.charAt(m)==="*"&&b.charAt(m+1)&&b.charAt(m+1)==="/")&&m<u){ai=b.charAt(m);af+=ai;if(ai==="\x0d"||ai==="\x0a"){aj=false}m+=1;if(m>=u){break}}}m+=2;if(aj){return["/*"+af+"*/","TK_INLINE_COMMENT"]}else{return["/*"+af+"*/","TK_BLOCK_COMMENT"]}}if(b.charAt(m)==="/"){af=ai;while(b.charAt(m)!=="\x0d"&&b.charAt(m)!=="\x0a"){af+=b.charAt(m);m+=1;if(m>=u){break}}m+=1;if(P){A()}return[af,"TK_COMMENT"]}}if(ai==="'"||ai==='"'||(ai==="/"&&((O==="TK_WORD"&&J(k,["return","do"]))||(O==="TK_START_EXPR"||O==="TK_START_BLOCK"||O==="TK_END_BLOCK"||O==="TK_OPERATOR"||O==="TK_EQUALS"||O==="TK_EOF"||O==="TK_SEMICOLON")))){var am=ai;var ah=false;var aa=ai;if(m<u){if(am==="/"){var ag=false;while(ah||ag||b.charAt(m)!==am){aa+=b.charAt(m);if(!ah){ah=b.charAt(m)==="\\";if(b.charAt(m)==="["){ag=true}else{if(b.charAt(m)==="]"){ag=false}}}else{ah=false}m+=1;if(m>=u){return[aa,"TK_STRING"]}}}else{while(ah||b.charAt(m)!==am){aa+=b.charAt(m);if(!ah){ah=b.charAt(m)==="\\"}else{ah=false}m+=1;if(m>=u){return[aa,"TK_STRING"]}}}}m+=1;aa+=am;if(am==="/"){while(m<u&&J(b.charAt(m),U)){aa+=b.charAt(m);m+=1}}return[aa,"TK_STRING"]}if(ai==="#"){var ad="#";if(m<u&&J(b.charAt(m),X)){do{ai=b.charAt(m);ad+=ai;m+=1}while(m<u&&ai!=="#"&&ai!=="=");if(ai==="#"){}else{if(b.charAt(m)=="["&&b.charAt(m+1)==="]"){ad+="[]";m+=2}else{if(b.charAt(m)=="{"&&b.charAt(m+1)==="}"){ad+="{}";m+=2}}}return[ad,"TK_WORD"]}}if(ai==="<"&&b.substring(m-1,m+3)==="<!--"){m+=3;q.in_html_comment=true;return["<!--","TK_COMMENT"]}if(ai==="-"&&q.in_html_comment&&b.substring(m-1,m+2)==="-->"){q.in_html_comment=false;m+=2;if(P){A()}return["-->","TK_COMMENT"]}if(J(ai,f)){while(m<u&&J(ai+b.charAt(m),f)){ai+=b.charAt(m);m+=1;if(m>=u){break}}if(ai==="="){return[ai,"TK_EQUALS"]}else{return[ai,"TK_OPERATOR"]}}return[ai,"TK_UNKNOWN"]}Y="";while(I>0){Y+=g;I-=1}b=c;z="";O="TK_START_EXPR";k="";v="";B=[];D=false;F="\n\r\t ".split("");U="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split("");X="0123456789".split("");f="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::".split(" ");s="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(",");d=[];l("BLOCK");m=0;while(true){var Q=T(m);o=Q[0];S=Q[1];if(S==="TK_EOF"){break}switch(S){case"TK_START_EXPR":if(o==="["){if(O==="TK_WORD"||k===")"){if(J(k,s)){w()}l("(EXPRESSION)");H();break}if(q.mode==="[EXPRESSION]"||q.mode==="[INDENTED-EXPRESSION]"){if(v==="]"&&k===","){if(q.mode==="[EXPRESSION]"){q.mode="[INDENTED-EXPRESSION]";if(!j){n()}}l("[EXPRESSION]");if(!j){A()}}else{if(k==="["){if(q.mode==="[EXPRESSION]"){q.mode="[INDENTED-EXPRESSION]";if(!j){n()}}l("[EXPRESSION]");if(!j){A()}}else{l("[EXPRESSION]")}}}else{l("[EXPRESSION]")}}else{l("(EXPRESSION)")}if(k===";"||O==="TK_START_BLOCK"){A()}else{if(O==="TK_END_EXPR"||O==="TK_START_EXPR"||O==="TK_END_BLOCK"){}else{if(O!=="TK_WORD"&&O!=="TK_OPERATOR"){w()}else{if(z==="function"){if(r){w()}}else{if(J(k,s)||k==="catch"){w()}}}}}H();break;case"TK_END_EXPR":if(o==="]"){if(j){if(k==="}"){M();H();e();break}}else{if(q.mode==="[INDENTED-EXPRESSION]"){if(k==="]"){e();A();H();break}}}}e();H();break;case"TK_START_BLOCK":if(z==="do"){l("DO_BLOCK")}else{l("BLOCK")}if(E){if(O!=="TK_OPERATOR"){A(true)}H();n()}else{if(O!=="TK_OPERATOR"&&O!=="TK_START_EXPR"){if(O==="TK_START_BLOCK"){A()}else{w()}}n();H()}break;case"TK_END_BLOCK":e();if(E){A();if(q.var_line_reindented){B.push(Y)}H()}else{if(O==="TK_START_BLOCK"){if(Z){M()}else{p()}}else{A();if(q.var_line_reindented){B.push(Y)}}H()}break;case"TK_WORD":if(D){w();H();w();D=false;break}if(o==="function"){if((Z||k==";")&&k!=="{"){h=Z?h:0;for(var W=0;W<2-h;W++){A(false)}}}if(o==="case"||o==="default"){if(k===":"){M()}else{q.indentation_level--;A();q.indentation_level++}H();q.in_case=true;break}N="NONE";if(O==="TK_END_BLOCK"){if(!J(o.toLowerCase(),["else","catch","finally"])){N="NEWLINE"}else{if(E){N="NEWLINE"}else{N="SPACE";w()}}}else{if(O==="TK_SEMICOLON"&&(q.mode==="BLOCK"||q.mode==="DO_BLOCK")){N="NEWLINE"}else{if(O==="TK_SEMICOLON"&&C(q.mode)){N="SPACE"}else{if(O==="TK_STRING"){N="NEWLINE"}else{if(O==="TK_WORD"){N="SPACE"}else{if(O==="TK_START_BLOCK"){N="NEWLINE"}else{if(O==="TK_END_EXPR"){w();N="NEWLINE"}}}}}}}if(O!=="TK_END_BLOCK"&&J(o.toLowerCase(),["else","catch","finally"])){A()}else{if(J(o,s)||N==="NEWLINE"){if(k==="else"){w()}else{if((O==="TK_START_EXPR"||k==="="||k===",")&&o==="function"){}else{if(k==="return"||k==="throw"){w()}else{if(O!=="TK_END_EXPR"){if((O!=="TK_START_EXPR"||o!=="var")&&k!==":"){if(o==="if"&&z==="else"&&k!=="{"){w()}else{A()}}}else{if(J(o,s)&&k!==")"){A()}}}}}}else{if(N==="SPACE"){w()}}}H();z=o;if(o==="var"){q.var_line=true;q.var_line_tainted=false}if(o==="if"||o==="else"){q.if_line=true}break;case"TK_SEMICOLON":H();q.var_line=false;break;case"TK_STRING":if(O==="TK_START_BLOCK"||O==="TK_END_BLOCK"||O==="TK_SEMICOLON"){A()}else{if(O==="TK_WORD"){w()}}H();break;case"TK_EQUALS":if(q.var_line){q.var_line_tainted=true}w();H();w();break;case"TK_OPERATOR":var a=true;var G=true;if(q.var_line&&o===","&&(C(q.mode))){q.var_line_tainted=false}if(q.var_line){if(o===","){if(q.var_line_tainted){H();A();B.push(Y);q.var_line_reindented=true;q.var_line_tainted=false;break}else{q.var_line_tainted=false}}}if(k==="return"||k==="throw"){w();H();break}if(o===":"&&q.in_case){H();A();q.in_case=false;break}if(o==="::"){H();break}if(o===","){if(q.var_line){if(q.var_line_tainted){H();A();q.var_line_tainted=false}else{H();w()}}else{if(O==="TK_END_BLOCK"&&q.mode!=="(EXPRESSION)"){H();A()}else{if(q.mode==="BLOCK"){H();A()}else{H();w()}}}break}else{if(J(o,["--","++","!"])||(J(o,["-","+"])&&(J(O,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||J(k,s)))){a=false;G=false;if(k===";"&&C(q.mode)){a=true}if(O==="TK_WORD"&&J(k,s)){a=true}if(q.mode==="BLOCK"&&(k==="{"||k===";")){A()}}else{if(o==="."){a=false}else{if(o===":"){if(!x()){a=false}}}}}if(a){w()}H();if(G){w()}if(o==="!"){}break;case"TK_BLOCK_COMMENT":var K=o.split(/\x0a|\x0d\x0a/);if(/^\/\*\*/.test(o)){A();B.push(K[0]);for(var W=1;W<K.length;W++){A();B.push(" ");B.push(K[W].replace(/^\s\s*|\s\s*$/,""))}}else{if(K.length>1){A();p()}else{w()}for(var W=0;W<K.length;W++){B.push(K[W]);B.push("\n")}}A();break;case"TK_INLINE_COMMENT":w();H();if(C(q.mode)){w()}else{A()}break;case"TK_COMMENT":if(P){A()}else{w()}H();A();break;case"TK_UNKNOWN":H();break}v=k;O=S;k=o}return B.join("").replace(/[\n ]+$/,"")};